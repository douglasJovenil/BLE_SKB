<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v15.3.0: Simple Network Time Protocol (SNTP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v15.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_sntp_client.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Simple Network Time Protocol (SNTP) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#SNTP_CLIENT_CODE">Code examples</a><ul><li class="level2"><a href="#SNTP_CLIENT_CODE_1">Initializing the module</a></li>
<li class="level2"><a href="#SNTP_CLIENT_CODE_2">Sending an SNTP query</a></li>
<li class="level2"><a href="#SNTP_CLIENT_CODE_3">Getting the local Unix time</a></li>
<li class="level2"><a href="#SNTP_CLIENT_CODE_4">Uninitializing the module</a></li>
</ul>
</li>
<li class="level1"><a href="#SNTP_CLIENT_CONF">Configuration parameters</a><ul><li class="level2"><a href="#SNTP_MAX_RETRANSMISSION_COUNT"></a></li>
<li class="level2"><a href="#SNTP_RETRANSMISSION_INTERVAL"></a></li>
<li class="level2"><a href="#SNTP_CLIENT_DISABLE_API_PARAM_CHECK"></a></li>
<li class="level2"><a href="#SNTP_CLIENT_DISABLE_LOGS"></a></li>
</ul>
</li>
<li class="level1"><a href="#SNTP_CLIENT_LIMITATIONS">Implementation specific limitations</a></li>
</ul>
</div>
<div class="textblock"><div class="whichSDs"><span>This information applies to the following SoftDevice: <b>S132</b></span></div><p>The <a class="el" href="group__sntp__client.html">SNTP Client</a> SNTP client module is a Simple Network Time Protocol Version 4 (SNTPv4) client implementation. It provides a local clock in the Unix time format and can query a Network Time Protocol (NTP) server and synchronize the local clock to the server time source.</p>
<p>The SNTP client requires the <a class="el" href="lib_iot_timer.html">IoT Timer</a> module to be present.</p>
<p>At initialization the local clock is set to zero, which is equivalent to the Unix epoch time 00:00:00 UTC on 1 January 1970. The local clock can be synchronised with an NTP server with the <a class="el" href="group__sntp__client.html#ga74c0640649e18bc02466193522ca5bdc">sntp_client_server_query</a> procedure. The module can be configured at initialization to provide asynchronous callbacks when a server response is received or when a query times out. The conversion between the NTP timestamp format and the Unix time format is done automatically.</p>
<p>The <a class="el" href="group__sntp__client.html#ga4e03b8f22fd99c0e89e658481fd049d1">sntp_client_local_time_get</a> procedure provides the local time without querying an NTP server. The elapsed time since the last synchronisation with an NTP server is calculated from the wall clock value of the IoT Timer module. Therefore, the accuracy of the local clock is limited by the value of <a class="el" href="lib_iot_timer.html#IOT_TIMER_RESOLUTION_IN_MS">IOT_TIMER_RESOLUTION_IN_MS</a>.</p>
<p>The SNTP Client module can be uninitialized with the <a class="el" href="group__sntp__client.html#gaac1dd780a4879e559cfac4614042bd0e">sntp_client_uninitialize</a> procedure. This frees up the UDP socket allocated for the module.</p>
<h1><a class="anchor" id="SNTP_CLIENT_CODE"></a>
Code examples</h1>
<h2><a class="anchor" id="SNTP_CLIENT_CODE_1"></a>
Initializing the module</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define SNTP_MAX_RETRANSMISSION_COUNT       2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define SNTP_RETRANSMISSION_INTERVAL        2</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> sntp_evt_handler(<span class="keyword">const</span> <a class="code" href="unionipv6__addr__t.html">ipv6_addr_t</a> * ntp_srv_addr, \</div>
<div class="line">                      uint16_t ntp_srv_udp_port,        \</div>
<div class="line">                      uint32_t process_result,          \</div>
<div class="line">                      <a class="code" href="unionsntp__client__cb__param__t.html" title="SNTP client callback parameter.">sntp_client_cb_param_t</a> callback_parameter)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*  ...  */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sntp_c_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t err_code = <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>;</div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="structsntp__client__init__param__t.html" title="SNTP client initialization structure.">sntp_client_init_param_t</a> sntp_client_init_param;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set the local UDP port.</span></div>
<div class="line">    sntp_client_init_param.<a class="code" href="structsntp__client__init__param__t.html#ae62d0fd4249063e61af41696fe325553">local_udp_port</a>  = 55000;</div>
<div class="line">    <span class="comment">// Set the event handler callback procedure. It can be set to NULL to disable callbacks.</span></div>
<div class="line">    sntp_client_init_param.<a class="code" href="structsntp__client__init__param__t.html#a40dcfd1328613032494102fc7958418a">app_evt_handler</a> = sntp_evt_handler;</div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__sntp__client.html#ga9237f25537470d078b458cb589708147" title="Function for initializing the SNTP client module.">sntp_client_init</a>(&amp;sntp_client_init_param);</div>
<div class="line">    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line"></div>
<div class="line">    iot_timer_init();   <span class="comment">// The IoT Timer module needs to be present.</span></div>
<div class="line">    sntp_c_init();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="SNTP_CLIENT_CODE_2"></a>
Sending an SNTP query</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define NTP_SERVER_DEFAULT_PORT 123</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">// The NTP server address is assumed by the API to be resident memory, thus the variable is not </span></div>
<div class="line"><span class="comment">// to be changed between the start and completion of an SNTP query.</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="unionipv6__addr__t.html">ipv6_addr_t</a> m_ntp_server_address = { .u8 = {0x26, 0x07, 0xfe, 0x70, 0x00, 0x00, 0x00, 0x16, \</div>
<div class="line">                                                   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a} };</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t err_code = <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>;</div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__sntp__client.html#ga74c0640649e18bc02466193522ca5bdc" title="Function for sending an SNTP query to the specified NTP server.">sntp_client_server_query</a>(&amp;m_ntp_server_address, \</div>
<div class="line">                                        m_ntp_server_port,     \</div>
<div class="line">                                        <span class="keyword">true</span>);</div>
<div class="line">    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="SNTP_CLIENT_CODE_3"></a>
Getting the local Unix time</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> procedure(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line"></div>
<div class="line">    time_t local_unix_time;</div>
<div class="line">    uint32_t err_code = <a class="code" href="group__sntp__client.html#ga4e03b8f22fd99c0e89e658481fd049d1" title="Function for getting the local unix time from the module.">sntp_client_local_time_get</a>(&amp;local_unix_time);</div>
<div class="line">    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="SNTP_CLIENT_CODE_4"></a>
Uninitializing the module</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> procedure(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line"></div>
<div class="line">    time_t current_local_time;</div>
<div class="line">    uint32_t err_code = <a class="code" href="group__sntp__client.html#gaac1dd780a4879e559cfac4614042bd0e" title="Function for uninitializing the SNTP client module.">sntp_client_uninitialize</a>();</div>
<div class="line">    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*  ...   */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="SNTP_CLIENT_CONF"></a>
Configuration parameters</h1>
<p>The following configuration parameters should be defined in <code>sdk_config.h</code>.</p>
<h2><a class="anchor" id="SNTP_MAX_RETRANSMISSION_COUNT"></a>
SNTP_MAX_RETRANSMISSION_COUNT</h2>
<p>Maximum number of retransmissions of a query. Set this define to 0 to disable retransmission attempts.</p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Minimum value </td><td>0 </td></tr>
<tr>
<td>Maximum value </td><td>255 </td></tr>
<tr>
<td>Dependencies </td><td>None </td></tr>
</table>
<h2><a class="anchor" id="SNTP_RETRANSMISSION_INTERVAL"></a>
SNTP_RETRANSMISSION_INTERVAL</h2>
<p>Interval between retransmissions in seconds.</p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Minimum value </td><td>1 </td></tr>
<tr>
<td>Maximum value </td><td>None </td></tr>
<tr>
<td>Dependencies </td><td>None </td></tr>
</table>
<h2><a class="anchor" id="SNTP_CLIENT_DISABLE_API_PARAM_CHECK"></a>
SNTP_CLIENT_DISABLE_API_PARAM_CHECK</h2>
<p>Disables API parameter checks in the module. Set this define to 1 to disable checks on API parameters in the module.</p>
<p>API parameter checks are added to ensure that the correct parameters are passed to the module. These checks are useful during development phase, but they might be redundant when the application is finalized. Disabling these checks might improve performance. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Enable API parameters check </td><td>0 </td></tr>
<tr>
<td>Disable API parameters check </td><td>1 </td></tr>
<tr>
<td>Dependencies </td><td>None </td></tr>
</table>
<h2><a class="anchor" id="SNTP_CLIENT_DISABLE_LOGS"></a>
SNTP_CLIENT_DISABLE_LOGS</h2>
<p>Disables debug tracing in the module. To enable tracing, this flag must be set to 0 and NRF_LOG_ENABLED must be set to 1. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Enable debug trace </td><td>0 </td></tr>
<tr>
<td>Disable debug trace </td><td>1 </td></tr>
<tr>
<td>Dependencies </td><td>NRF_LOG_ENABLED </td></tr>
</table>
<h1><a class="anchor" id="SNTP_CLIENT_LIMITATIONS"></a>
Implementation specific limitations</h1>
<ul>
<li>
Parallel queries are not supported. </li>
<li>
The exponential-backoff algorithm for retransmissions (as described in RFC 4330) is not implemented, and retransmissions are triggered at regular intervals.  </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Fri Feb 15 2019" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
