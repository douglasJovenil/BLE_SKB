<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v15.3.0: Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v15.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('iot_sdk_app_ipv6_stack_udp_server.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="whichSDs"><span>This information applies to the following SoftDevices: <b>S132, S140</b></span></div><p>This nRF UDP Server example shows the usage of Nordic's IPv6 Stack for sending and receiving UDP packets. The port numbers for transmitting and receiving UDP packets are configured in <code>main.c</code>. The server responds to ICMPv6 Echo Requests and any received UDP packets are sent back to their source address without any modification. The operation of the application is reflected by two LEDs on the board. If UART trace is enabled, the sequence numbers of the received UDP packets are logged. For this feature to work, the payload of the received UDP packet is expected to have the following format:</p>
<table  style="border-collapse: collapse;">
<tr bgcolor="#FFFFFF">
<td align="center" width="225 px" style="border: 1px solid black;border-collapse: collapse;">Packet sequence number <br/>
in uint32 format (4 bytes) </td><td align="center" width="250 px" style="border: 1px solid black;border-collapse: collapse;">16 bytes of random data  </td></tr>
</table>
<p>The UDP client could be a PC application communicating to the UDP server on the kit, as shown in <b>Figure 1</b> below.</p>
<p><br/>
 </p>
<div class="image">
<img src="nRF_UDP_Server.svg" alt="nRF_UDP_Server.svg"/>
<div class="caption">
Figure 1: Setup of the Nordic's IPv6 stack based UDP server application.</div></div>
<p><br/>
</p>
<p>Or, the UDP client could be the example client application included in the SDK sending requests to the server, as shown in <b>Figure 2</b>.</p>
<p><br/>
 </p>
<div class="image">
<img src="nRF_UDP_Client_Server.svg" alt="nRF_UDP_Client_Server.svg"/>
<div class="caption">
Figure 2: Setup of the Nordic's IPv6 stack based UDP client with UDP server application.</div></div>
<p><br/>
</p>
<p><b>Figure 3</b> shows the application state diagram.</p>
<div class="image">
<img src="Nordic_UDP_Example_Server.png" alt="Nordic_UDP_Example_Server.png"/>
<div class="caption">
Figure 3: nRF UDP Server state diagram.</div></div>
<p> Configuration parameters for all used modules are defined and described in the <b>sdk_config.h</b> file. This file is located in the <b>config</b> subfolder of the main application folder. For UDP port configuration, see <code>main.c</code>.</p>
<dl class="section note"><dt>Note</dt><dd>This application is not power optimized! </dd>
<dd>
This application will start advertising again after disconnection.</dd></dl>
<h1><a class="anchor" id="iot_sdk_app_nordic_udp_server_module_usage"></a>
Common module dependency and usage</h1>
<p>This section summarizes the usage of nRF5x resources and common modules in the examples apart from the IoT 6lowpan and IPv6 stack library.</p>
<table class="doxtable">
<tr>
<th>Module </th><th>Inclusion/Usage </th><th>Description </th></tr>
<tr>
<td>Timer </td><td>2 </td><td>Two timers are used - one for LED blinks and one for initiating periodic echo requests. </td></tr>
<tr>
<td>Buttons </td><td>0 </td><td>No buttons are used in this example. </td></tr>
<tr>
<td>LEDs </td><td>4 </td><td>LEDs are used to indicate the application states. See <a class="el" href="iot_sdk_app_ipv6_stack_udp_server.html#iot_sdk_app_ipv6_stack_udp_server_led">LED assignments</a>. </td></tr>
<tr>
<td>Adv Data Encoder </td><td>Yes </td><td>The device name used is 'UDP6_Server_Node', IPSP Service UUID is included in the UUID list. </td></tr>
<tr>
<td>Scheduler </td><td>Yes </td><td>Scheduler is used for processing stack events. </td></tr>
</table>
<h1><a class="anchor" id="iot_sdk_app_ipv6_stack_udp_server_setup"></a>
Setup</h1>
<p>You can find the source code and the project file of the example in the following folder: <code>&lt;InstallFolder&gt;\examples\iot\udp\ipv6\server</code> </p>
<h1><a class="anchor" id="iot_sdk_app_ipv6_stack_udp_server_led"></a>
LED assignments</h1>
<table  style="border-collapse: collapse;">
<tr>
<th align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;border-bottom: 2px solid black;">LED 1 </th><th align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;border-bottom: 2px solid black;">LED 2 </th><th align="center" width="450 px" style="border: none;           border-collapse: collapse;"></th></tr>
<tr bgcolor="#FFFFFF">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Blinking </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Off </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">Device advertising as BLE peripheral.  </td></tr>
<tr bgcolor="#E8E8E8">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Blinking </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">BLE link established, IPv6 interface down.  </td></tr>
<tr bgcolor="#FFFFFF">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Off </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">BLE link established, IPv6 interface up.  </td></tr>
<tr bgcolor="#E8E8E8">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Two rapid flashes </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">Echo Request received and Echo Response is sent.  </td></tr>
<tr bgcolor="#FFFFFF">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">Blinking </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">Receiving and immediately transmitting UDP packets.  </td></tr>
<tr bgcolor="#E8E8E8">
<td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="130 px" style="border: 1px solid black;border-collapse: collapse;">On </td><td align="center" width="450 px" style="border: 1px solid black;border-collapse: collapse;">Assertion failure in the application.  </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>If commissioning is enabled, additional <a class="el" href="iot_commissioning_howtorun.html#iot_commissioning_leds_buttons">LED and Button assignments</a> are made.</dd></dl>
<h1><a class="anchor" id="iot_sdk_app_ipv6_stack_udp_server_test"></a>
Testing</h1>
<p>See <a class="el" href="iot_sdk_user_guides_linux_commands.html">Connecting devices to the router</a> for a list of relevant Linux commands.</p>
<ol type="1">
<li>Compile and program the application. Observe that the device is advertising.</li>
<li>Prepare the Linux router device by <a class="el" href="iot_sdk_user_guides_linux_commands.html#iot_sdk_user_guides_linux_commands_init">initializing the 6LoWPAN module</a>.</li>
<li>Discover the advertising device by using the <a class="el" href="iot_sdk_user_guides_linux_commands.html#iot_sdk_user_guides_linux_commands_lescan">hcitool lescan</a> command.</li>
<li>Connect to the discovered device from the Linux console by using the <a class="el" href="iot_sdk_user_guides_linux_commands.html#iot_sdk_user_guides_linux_commands_connect">Bluetooth 6LoWPAN connect</a> command.</li>
<li>Check if the connected state is reflected by the LEDs.</li>
<li>Run the Wireshark or hcidump program to monitor the <b>btX</b> interface.</li>
<li>An ICMPv6 ping can be used on the link-local and on the global IPv6 address assigned to the device to check if the device is reachable. <dl class="section note"><dt>Note</dt><dd>To find the global address, use the prefix assigned to the interface in Router Advertisement.</dd></dl>
</li>
<li>When sending Echo Requests or UDP packets to port number 9000 on the server, observe the LED light pattern as described in <a class="el" href="iot_sdk_app_ipv6_stack_udp_server.html#iot_sdk_app_ipv6_stack_udp_server_setup">Setup</a>. Send UDP packets to port number 9000 on the server and observe that packets are sent back. <dl class="section note"><dt>Note</dt><dd>This example is designed to complement the Nordic UDP Client example, and they will work together provided that the Nordic UDP Client application is modified with the address of the server.</dd></dl>
</li>
<li>Disconnect from the device by using the <a class="el" href="iot_sdk_user_guides_linux_commands.html#iot_sdk_user_guides_linux_commands_disconnect">Bluetooth 6LoWPAN disconnect</a> command.</li>
<li>Observe that the device is advertising.</li>
</ol>
<h1><a class="anchor" id="iot_sdk_app_ipv6_stack_udp_server_python_sample"></a>
Python Client Example</h1>
<p>Use the code below to start a simple Python client that sends UDP packets to port 9000, prints the sequence number from both transmitted and incoming packets and check if they are equal. The server address used here is an example address and will need to be modified based on the server address of the nRF5x that runs the Nordic UDP server application.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> <a class="code" href="group__iot__socket.html#ga241c3f1f3142c3054eeba31830638fdb" title="Function for creating a socket.">socket</a></div>
<div class="line"><span class="keyword">import</span> <span class="keyword">struct</span></div>
<div class="line"><span class="keyword">import</span> random</div>
<div class="line"></div>
<div class="line">SERVER_ADDR = <span class="stringliteral">&#39;2001:DB8::2AA:BBFF:FECC:DDEE&#39;</span></div>
<div class="line">CLIENT_ADDR = <span class="stringliteral">&#39;2001:DB8::1&#39;</span></div>
<div class="line">UDP_PORT    = 9000</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line">    sequence_number = 0</div>
<div class="line">    sock = <a class="code" href="group__iot__socket.html#ga241c3f1f3142c3054eeba31830638fdb" title="Function for creating a socket.">socket</a>.socket(<a class="code" href="group__iot__socket.html#ga241c3f1f3142c3054eeba31830638fdb" title="Function for creating a socket.">socket</a>.AF_INET6, <a class="code" href="group__iot__socket.html#ga241c3f1f3142c3054eeba31830638fdb" title="Function for creating a socket.">socket</a>.SOCK_DGRAM)</div>
<div class="line">    client_addr = (CLIENT_ADDR, UDP_PORT)</div>
<div class="line">    sock.bind(client_addr)</div>
<div class="line">    <span class="keywordflow">while</span> sequence_number &lt; 101 :</div>
<div class="line">        sequence_number+= 1</div>
<div class="line">        data = <span class="keyword">struct</span>.pack(<span class="stringliteral">&quot;I&quot;</span>, sequence_number)</div>
<div class="line">        data += <span class="stringliteral">&#39;&#39;</span>.join(chr(val) <span class="keywordflow">for</span> val in [random.randint(0,0xFF) <span class="keywordflow">for</span> r in xrange(16)])</div>
<div class="line">        sock.sendto(data, (SERVER_ADDR, UDP_PORT))</div>
<div class="line">        print <span class="stringliteral">&#39;Tx Sequence Number: &#39;</span> + str(sequence_number)</div>
<div class="line">        recv_data = sock.<a class="code" href="group__iot__socket.html#ga738fd897997a2757cff20b1dd69147fe" title="Function for receiving datagram on a socket.">recvfrom</a>(8)</div>
<div class="line">        rx_sequence_number = struct.unpack(&quot;I&quot;, recv_data[0][:4])[0]</div>
<div class="line">        print &#39;Rx Sequence Number: &#39; + str(rx_sequence_number)</div>
<div class="line">        if sequence_number != rx_sequence_number:</div>
<div class="line">            print &#39;Sequence number mismatch!&#39;</div>
<div class="line">    sock.<a class="code" href="group__iot__socket.html#ga39ecdd30e1f3c67e474e77682ac7a765" title="Function for closing a socket and freeing any resources held by it.">close</a>()</div>
<div class="line">    del sock</div>
</div><!-- fragment --><h1><a class="anchor" id="iot_sdk_app_ipv6_stack_udp_server_tbg"></a>
Troubleshooting Guide</h1>
<ol type="1">
<li>It is possible that the global address is not immediately available on the connection as the Neighbor Discovery, Router Advertisement, and Duplicate Address Detection procedures take a few seconds to complete.</li>
<li>If you observe that the packets from the client are received at the btX interface but the server never receives them, it is possible that the forwarding between networks is not enabled. This can be done on Linux using the command <code>sysctl -w net.ipv6.conf.all.forwarding=1</code>.</li>
<li>In case the server is reachable, but the Echo Requests from the client do not make it to the server, it is possible that the application is not configured with the correct remote server address. Verify that the address SERVER_IPV6_ADDRESS in the client application matches the server address. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Fri Feb 15 2019" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
