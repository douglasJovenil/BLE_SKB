<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v15.3.0: Running an example application with commissioning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v15.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('iot_commissioning_howtorun.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Running an example application with commissioning </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Commissioning a <em>Bluetooth</em> Smart node to a 6LoWPAN network is integrated into all example applications in the IoT SDK. This section describes how to enable commissioning in an example application.</p>
<h1><a class="anchor" id="iot_commissioning_quick_example_1"></a>
Enable commissioning mode and program the application</h1>
<p>Choose one of the projects inside the IoT SDK, for example <a class="el" href="iot_sdk_app_coap_server.html">CoAP server</a>.</p>
<p>In order to activate commissioning mode, the following symbol has to be defined for the C preprocessor: </p>
<div class="fragment"><div class="line">COMMISSIONING_ENABLED</div>
</div><!-- fragment --><p>To define the COMMISSIONING_ENABLED symbol in Keil ÂµVision projects, open the <b>Options for Target</b> dialog and select the <b>C/C++</b> tab. In the <b>Define</b> field, add <b>COMMISSIONING_ENABLED</b> to the end of the define. <br/>
 </p>
<div class="image">
<img src="dfu_define.png" alt="dfu_define.png"/>
</div>
<p> <br/>
</p>
<p>To define the COMMISSIONING_ENABLED symbol for the ARM GCC compiler, add the following line in the C flags section of the Makefile: </p>
<div class="fragment"><div class="line">CFLAGS  += -DCOMMISSIONING_ENABLED</div>
</div><!-- fragment --><p>Now compile the example and flash it to the nRF52 Developer Kit.</p>
<h1><a class="anchor" id="iot_commissioning_ram_adjustments"></a>
Adjust RAM settings</h1>
<p>By default, the IoT examples are using a RAM setting which is too small for the commissioning mode compilation. To adjust this, run the example with Serial UART connected and read out the proposed new values from the console log. An example of this can be seen below: <br/>
 </p>
<div class="image">
<img src="commissioning_ram_adjustment_uart.png" alt="commissioning_ram_adjustment_uart.png"/>
</div>
<p> <br/>
</p>
<p>In this example, the new values would be RAM start address <b>0x20002098</b> and size <b>0xDF68</b>.</p>
<p>For Keil projects, open the <b>Options for Target</b> dialog and select the <b>Target</b> tab (default tab). Then, modify the IRAM1 with the new values from the Serial UART log. <br/>
 </p>
<div class="image">
<img src="commissioning_ram_adjustment_keil_new.png" alt="commissioning_ram_adjustment_keil_new.png"/>
</div>
<p> <br/>
</p>
<p>For ARM GCC project, open up the corresponding linker script for the project under, for example, <b>iot_ipv6_coap_server_gcc_nrf52.ld</b> in the <code>pca10040/s132/armgcc</code> folder. Modify the <b>MEMORY</b> section with the new RAM values from the Serial UART log. The linker script <b>MEMORY</b> region should look like this:</p>
<div class="fragment"><div class="line">MEMORY</div>
<div class="line">{</div>
<div class="line">  FLASH (rx) : ORIGIN = 0x23000, LENGTH = 0x5d000</div>
<div class="line">  RAM (rwx) :  ORIGIN = 0x20002098, LENGTH = 0xdf68 <span class="comment">/* Modified content */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Now, compile the RAM-adjusted example and flash it to the nRF5 Development Kit.</p>
<h2><a class="anchor" id="iot_commissioning_leds_buttons"></a>
Button and LED assignments</h2>
<p>Once commissioning is enabled, some of the LEDs (<b>LED 3</b> and <b>LED 4</b> in most cases) are used to indicate that the node is in <a class="el" href="iot_commissioning_ble_profile.html#commissioning_profile_procedure">Identity mode</a>. Depending on the application, <b>Button 3</b> or <b>Button 4</b> is used to erase commissioning-related settings from persistent storage.</p>
<dl class="section note"><dt>Note</dt><dd>The commissioning module does not support Raw mode of the persistent storage manager. Therefore, if Raw mode is used by the application, the original Button assignment stays in place.</dd></dl>
<h1><a class="anchor" id="iot_commissioning_quick_example_2"></a>
Prepare the router side</h1>
<p>The Linux based daemon has been prepared for the edge router. The current version of the daemon was tested on OpenWRT targets (Chaos Calmer 15.05) and Ubuntu (Linux Kernel 3.18+), and the documentation describes usage on these systems.</p>
<p>The first step is to build and run the <a class="el" href="iot_commissioning_daemon.html">bluetooth_6lowpand</a> daemon.</p>
<p>After the daemon is successfully built, start it up and test if the help window is visible. </p>
<div class="fragment"><div class="line">bluetooth_6lowpand --help</div>
</div><!-- fragment --><p>On an OpenWRT platform with Wi-Fi enabled, the Wi-Fi network configuration can be read and reused by the daemon. In this example, however, the SSID and passphrase will be manually added.</p>
<p>Run the following commands:</p>
<ol type="1">
<li>Ensure bluetoothd daemon is turned off. <div class="fragment"><div class="line">killall bluetoothd</div>
</div><!-- fragment --></li>
<li>Reset the HCI interface. <div class="fragment"><div class="line">hciconfig hci0 reset</div>
</div><!-- fragment --></li>
<li>Run the daemon and provide SSID and passphrase as arguments. <div class="fragment"><div class="line">bluetooth_6lowpand -a Nordic:123456</div>
</div><!-- fragment --></li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The Linux Kernel does not support BLE Legacy Pairing using OOB - Passkey pairing is used. That means, the passphrase has to have six ascii-digital characters. </dd>
<dd>
The router daemon may also be run using init.d script, by executing <code>/etc/init</code>.d/bluetooth_6owpand start.</dd></dl>
<h1><a class="anchor" id="iot_commissioning_quick_example_3"></a>
Prepare the commissioner</h1>
<p>Prepare the Trusted Third Party by installing and running the <a class="el" href="iot_commissioning_phone_app.html">nRF IoT Joiner</a> Android application.</p>
<p>Configure Wi-Fi manually with the credentials given to the router.</p>
<ul>
<li><b>SSID</b>: Nordic</li>
<li><b>Passphrase</b>: 123456</li>
</ul>
<p>The next step is to find the already advertising nRF device, which should be visible as <b>NodeCFG</b> in the main dashboard of the mobile application. Select the proper device and configure it with the default parameters (10 seconds delay, 20 seconds of timeout). After the configured delay, the node should connect to the network automatically.</p>
<h1><a class="anchor" id="iot_commissioning_quick_example_4"></a>
Test the application</h1>
<p>Test if the pre-flashed application works properly, for example by pinging the commissioned device.</p>
<div class="fragment"><div class="line">-# For the node with the Bluetooth device address 00:aa:bb:cc:dd:ee</div>
<div class="line">ping6 fe80::2aa:bbff:fecc:ddee -I bt0</div>
</div><!-- fragment --><p> <br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Fri Feb 15 2019" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
